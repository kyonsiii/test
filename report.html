<!DOCTYPE html>
<html lang="ja">
    <head>
        <!--https://csshtml.work/click-button/ ÂèÇËÄÉ„Å´„Åó„Åü„Éú„Çø„É≥„ÅÆ‰Ωú„ÇäÊñπ„ÄÇ„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ-->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="style.css" rel="stylesheet"/>
        <script src="js/main.js"></script>
        <script src="js/pokeReport.js"></script>
        <script src="js/pokedex2.js"></script>
        <script src="js/recipedb.js"></script>

        <title>„É¨„Éù„Éº„Éà(‰ªÆ)v0.4.2f</title>

    </head>


    <body style="max-width: 30em;">
        <div id="page_link">
            <a href = "./index.html"><img src="img/pages/pokedex.png"></a>
            <a href = "./sleep.html"><img src="img/pages/sleep.png"></a>
            <a href = "./cook.html"><img src="img/pages/cook.png"></a>            
            <a href = "./report.html" class ="current"><img src="img/pages/report.png"></a>
        </div>



        <div class="input_form_area">
            <div style="display: flex; justify-content: space-between; background-color: beige;">
                <strong id="page_title"> My„Éù„Ç±„É¢„É≥ÁôªÈå≤:</strong>
                <span visible="false" style="background-color: powderblue; border: grey 1px solid; cursor: default;" onclick="showHideInputForm(this);">„ÄÄË°®Á§∫‚ñº</span>
            </div>
            <div id="input_form" style="display: none;">
                <select id="input_mypoke_name" style="width:10em; font-size:1em" onclick="initializePokeList()" onchange="setFoodImages(this)" src></select>
                Lv<select id="input_mypoke_lv" style="width:4em; font-size:1em" onclick="initializePokeList()"></select>
    
                <img id="input_mypoke_food_1" src="" dir="img/food/" class="ex-tiny" style="vertical-align: bottom;" onclick="toggleFood(this)">
                <img id="input_mypoke_food_2" src="" dir="img/food/" class="ex-tiny" style="vertical-align: bottom;" onclick="toggleFood(this)">
                <img id="input_mypoke_food_3" src="" dir="img/food/" class="ex-tiny" style="vertical-align: bottom;" onclick="toggleFood(this)">
                <br>
                <select id="input_mypoke_char" style="width:15.5em; font-size:1em">
                    <option value="">--„Åõ„ÅÑ„Åã„Åè„ÇíÈÅ∏Êäû--</option>
                    <option value="ÂØÇ">„Åï„Åø„Åó„Åå„Çä (ÈÄü‚ÜëÂÖÉ‚Üì)</option>
                    <option value="„ÅÑ">„ÅÑ„Åò„Å£„Å±„Çä (ÈÄü‚ÜëÈ£ü‚Üì)</option>
                    <option value="„ÇÑ">„ÇÑ„Çì„Å°„ÇÉ (ÈÄü‚Üë„Çπ‚Üì)</option>
                    <option value="Âãá">„ÇÜ„ÅÜ„Åã„Çì (ÈÄü‚ÜëE‚Üì)</option>
                    <option value="„Åö">„Åö„Å∂„Å®„ÅÑ (ÂÖÉ‚ÜëÈÄü‚Üì)</option>
                    <option value="„Çè">„Çè„Çì„Å±„Åè (ÂÖÉ‚ÜëÈ£ü‚Üì)</option>
                    <option value="ËÉΩ">„ÅÆ„ÅÜ„Å¶„Çì„Åç (ÂÖÉ‚Üë„Çπ‚Üì)</option>
                    <option value="„ÅÆ">„ÅÆ„Çì„Åç (ÂÖÉ‚ÜëE‚Üì)</option>
                    <option value="„Å≤">„Å≤„Åã„Åà„ÇÅ (È£ü‚ÜëÈÄü‚Üì)</option>
                    <option value="„Åä">„Åä„Å£„Å®„Çä (È£ü‚ÜëÂÖÉ‚Üì)</option>
                    <option value="„ÅÜ">„ÅÜ„Å£„Åã„Çä„ÇÑ (È£ü‚Üë„Çπ‚Üì)</option>
                    <option value="ÂÜ∑">„Çå„ÅÑ„Åõ„ÅÑ (È£ü‚ÜëE‚Üì)</option>
                    <option value="Á©è">„Åä„Å†„ÇÑ„Åã („Çπ‚ÜëÈÄü‚Üì)</option>
                    <option value="Â§ß">„Åä„Å®„Å™„Åó„ÅÑ („Çπ‚ÜëÂÖÉ‚Üì)</option>
                    <option value="ÊÖé">„Åó„Çì„Å°„Çá„ÅÜ („Çπ‚ÜëÈ£ü‚Üì)</option>
                    <option value="„Å™">„Å™„Åæ„ÅÑ„Åç („Çπ‚ÜëE‚Üì)</option>
                    <option value="ËáÜ">„Åä„Åè„Å≥„Çá„ÅÜ (E‚ÜëÈÄü‚Üì)</option>
                    <option value="„Åõ">„Åõ„Å£„Åã„Å° (E‚ÜëÂÖÉ‚Üì)</option>
                    <option value="ÈôΩ">„Çà„ÅÜ„Åç (E‚ÜëÈ£ü‚Üì)</option>
                    <option value="„ÇÄ">„ÇÄ„Åò„ÇÉ„Åç (E‚Üë„Çπ‚Üì)</option>
                    <option value="‚ñ°">„Åå„Çì„Å∞„Çä„ÇÑ (ÁÑ°Ë£úÊ≠£)</option>
                    <option value="‚ñ°">„Åô„Å™„Åä (ÁÑ°Ë£úÊ≠£)</option>
                    <option value="‚ñ°">„Å¶„Çå„ÇÑ (ÁÑ°Ë£úÊ≠£)</option>
                    <option value="‚ñ°">„Åç„Åæ„Åê„Çå (ÁÑ°Ë£úÊ≠£)</option>
                    <option value="‚ñ°">„Åæ„Åò„ÇÅ (ÁÑ°Ë£úÊ≠£)</option>
                </select>
    
                <button onclick="showBerryPower();">üçí</button>    
    
                <div id="sub_skill_area">
                    <select id="sub_skill_lv10" onchange="changeSubSkill(this);"></select>    
                    <select id="sub_skill_lv25" onchange="changeSubSkill(this);"></select>
                    <br>    
                    <select id="sub_skill_lv50" onchange="changeSubSkill(this);"></select>
                    <select id="sub_skill_lv75" onchange="changeSubSkill(this);"></select>
                    <br>    
                    <select id="sub_skill_lv100" onchange="changeSubSkill(this);"></select>
    
                    <input id="sub_skill_import" type="text" oninput="setInfoFromClipboard(this);">
                </div>    
    
                <div id="input_color_buttons">
                    <input type="radio" name="color_picker" value="0" id="color_pick_SB" checked><label for="color_pick_SB">‚ñ°</label>
                    <input type="radio" name="color_picker" value="1" id="color_pick_BL"><label for="color_pick_BL">‚ñ°</label>  
                    <input type="radio" name="color_picker" value="2" id="color_pick_SL"><label for="color_pick_SL">‚ñ°</label>
                    <input type="radio" name="color_picker" value="3" id="color_pick_PK"><label for="color_pick_PK">‚ñ°</label>
                    <input type="radio" name="color_picker" value="4" id="color_pick_OR"><label for="color_pick_OR">‚ñ°</label>
                    <input type="radio" name="color_picker" value="5" id="color_pick_RD"><label for="color_pick_RD">‚ñ°</label>
                    <input type="radio" name="color_picker" value="6" id="color_pick_GR"><label for="color_pick_GR">‚ñ°</label>                   
                    <input type="radio" name="color_picker" value="7" id="color_pick_GD"><label for="color_pick_GD">‚ñ°</label>                    
                </div>    
    
                <button id="input_mypoke_register" style="font-size:1em; vertical-align: middle;" onclick="registerMyPoke();">My„Éù„Ç±„É¢„É≥„Å´ËøΩÂä†</button> 
                <button id="input_mypoke_reset" style="font-size:1em; vertical-align: middle;" onclick="resetInputForm();">„É™„Çª„ÉÉ„Éà</button>  
            </div>                      
        </div>



        <div id="input_filter_option">
            <div class="select_button_area">
                <input type="checkbox" id="option_poke_30" checked><label for="option_poke_30">Lv30„ÇíË°®Á§∫</label>
                <input type="checkbox" id="option_poke_60" checked><label for="option_poke_60">Lv60„ÇíË°®Á§∫</label>
            </div>

            <div class="select_button_area">
                <input type="checkbox" onclick="clickMyPokeVisible(this);" id="option_mypoke_visible" checked><label for="option_mypoke_visible">My„Éù„Ç±Ë°®Á§∫</label>
                <input type="checkbox" onclick="clickMyPokeVisible(this);" id="option_potential_30" checked><label for="option_potential_30">Lv30‰∫àÂÆö</label>
                <input type="checkbox" onclick="clickMyPokeVisible(this);" id="option_potential_50" checked><label for="option_potential_50">Lv50‰∫àÂÆö</label>
                <input type="checkbox" onclick="clickMyPokeVisible(this);" id="option_potential_60"><label for="option_potential_60">Lv60‰∫àÂÆö</label>                
            </div>

            <div class="select_button_area">
                <input type="checkbox" id="only_fully_evolved" checked="true"><label for="only_fully_evolved">ÊúÄÁµÇÈÄ≤Âåñ„ÅÆ„Åø</label>
           
                È£üÊùêÊï∞:
                <select id="food_min" style="width:8em; font-size:1em">
                    <option value=  "1">1ÂÄã‰ª•‰∏ä</option>
                    <option value= "10">10ÂÄã‰ª•‰∏ä</option>
                    <option value= "20">20ÂÄã‰ª•‰∏ä</option>
                    <option value= "30">30ÂÄã‰ª•‰∏ä</option>
                    <option value= "40">40ÂÄã‰ª•‰∏ä</option>
                    <option value= "50">50ÂÄã‰ª•‰∏ä</option>
                    <option value= "60">60ÂÄã‰ª•‰∏ä</option>
                    <option value= "70">70ÂÄã‰ª•‰∏ä</option>
                    <option value= "80">80ÂÄã‰ª•‰∏ä</option>
                    <option value= "90">90ÂÄã‰ª•‰∏ä</option>
                    <option value="100">100ÂÄã‰ª•‰∏ä</option>
                </select>
            </div>

        </div>
    
        <div id="food_buttons">
            <img name="„Å®„Åè„Åõ„Çì„É™„É≥„Ç¥" src="img/food/„Å®„Åè„Åõ„Çì„É™„É≥„Ç¥.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„É¢„Éº„É¢„Éº„Éü„É´„ÇØ" src="img/food/„É¢„Éº„É¢„Éº„Éü„É´„ÇØ.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„ÉØ„Ç´„ÇØ„ÇµÂ§ßË±Ü" src="img/food/„ÉØ„Ç´„ÇØ„ÇµÂ§ßË±Ü.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„ÅÇ„Åæ„ÅÑ„Éü„ÉÑ" src="img/food/„ÅÇ„Åæ„ÅÑ„Éü„ÉÑ.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„Éû„É°„Éü„Éº„Éà" src="img/food/„Éû„É°„Éü„Éº„Éà.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„ÅÇ„Å£„Åü„Åã„Ç∏„É≥„Ç∏„É£„Éº" src="img/food/„ÅÇ„Å£„Åü„Åã„Ç∏„É≥„Ç∏„É£„Éº.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„ÅÇ„Çì„Åø„Çì„Éà„Éû„Éà" src="img/food/„ÅÇ„Çì„Åø„Çì„Éà„Éû„Éà.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„Å®„Åè„Åõ„Çì„Ç®„ÉÉ„Ç∞" src="img/food/„Å®„Åè„Åõ„Çì„Ç®„ÉÉ„Ç∞.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„Éî„É•„Ç¢„Å™„Ç™„Ç§„É´" src="img/food/„Éî„É•„Ç¢„Å™„Ç™„Ç§„É´.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„Åª„Å£„Åì„Çä„Éù„ÉÜ„Éà" src="img/food/„Åª„Å£„Åì„Çä„Éù„ÉÜ„Éà.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„Åí„Åç„Åã„Çâ„Éè„Éº„Éñ" src="img/food/„Åí„Åç„Åã„Çâ„Éè„Éº„Éñ.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„É™„É©„ÉÉ„ÇØ„Çπ„Ç´„Ç´„Ç™" src="img/food/„É™„É©„ÉÉ„ÇØ„Çπ„Ç´„Ç´„Ç™.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„ÅÇ„Åò„Çè„ÅÑ„Ç≠„Éé„Ç≥" src="img/food/„ÅÇ„Åò„Çè„ÅÑ„Ç≠„Éé„Ç≥.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„Åµ„Å®„ÅÑ„Å™„Åå„Å≠„Åé" src="img/food/„Åµ„Å®„ÅÑ„Å™„Åå„Å≠„Åé.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„Åä„ÅÑ„Åó„ÅÑ„Ç∑„ÉÉ„Éù" src="img/food/„Åä„ÅÑ„Åó„ÅÑ„Ç∑„ÉÉ„Éù.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„ÉØ„Ç´„ÇØ„Çµ„Ç≥„Éº„É≥" src="img/food/„ÉØ„Ç´„ÇØ„Çµ„Ç≥„Éº„É≥.png" onclick="selectIcon(this);setResultOf(this)">
            <img name="„ÇÅ„Åñ„Åæ„Åó„Ç≥„Éº„Éí„Éº" src="img/food/„ÇÅ„Åñ„Åæ„Åó„Ç≥„Éº„Éí„Éº.png" onclick="selectIcon(this);setResultOf(this)">

            <div id="area_of_recipes">
                <select id="select_recipe_category" style="font-size:1em; width:6em;" onchange="selectRecipeCategory(this);">
                    <option value="">ALL</option>
                    <option value="„Ç´„É¨„Éº„Éª„Ç∑„ÉÅ„É•„Éº">„Ç´„É¨„Éº</option>
                    <option value="„Çµ„É©„ÉÄ">„Çµ„É©„ÉÄ</option>
                    <option value="„Éá„Ç∂„Éº„Éà„Éª„Éâ„É™„É≥„ÇØ">„Éá„Ç∂„Éº„Éà</option>
                </select>

                <select id="select_recipe" style="font-size:1em; width:15em;" onchange="selectFoodsByRecipe(this);">
                </select>
            </div>
        </div>



        <div id="result">
            <table id="result_table">
                <thead>
                    <tr>
                        <th>„Éù„Ç±„É¢„É≥</th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>

            </table>
        </div>


        <div id="mypoke_list">
            <strong>ÁôªÈå≤Ê∏à„ÅøMy„Éù„Ç±„É¢„É≥:</strong><br>
            <div style="display: flex;">
                <select id="input_mypoke_registered" style="flex:1; font-size:1em; vertical-align: middle;"></select>
                <button id="input_mypoke_reedit" style="font-size:1em; vertical-align: middle; white-space: nowrap;" onclick="reeditMypoke();">Á∑®ÈõÜ</button>
                <br>
            </div>
            
            <button id="input_mypoke_delete" style="font-size:1em; vertical-align: middle;" onclick="deleteSelectedMyPoke();">ÂâäÈô§</button>            
            <div>
                <table id="mypoke_quick_check_food">
                    <thead>
                        <tr>
                            <th>È£üÊùê</th>
                            <th>My„Éù„Ç±„É¢„É≥</th>   
                            <th></th>   
                            <th></th>   
                            <th></th>                            
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>

                <table id="mypoke_quick_check">
                    <thead>
                        <tr>
                            <th style="width: 20em;">My„Éù„Ç±„É¢„É≥</th>
                            <th style="width:  9em;">„Åç„ÅÆ„Åø„Éë„ÉØ„Éº</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>


            </div>

            <button style="font-size:1em; vertical-align: middle;" onclick="copyCookieValue();">Cookie„ÇíÂèñÂæó</button>
            <button style="font-size:1em; vertical-align: middle;" onclick="importCookieValue();">Âæ©ÂÖÉ</button><br>
            <input id="mypoke_import_cookie" type="text">
        </div>





























        <!--‰ª•‰∏ã„ÄÅ„Çπ„ÇØ„É™„Éó„Éà-->
        <script>
            const cookie_mypoke_max = 200;
            let lastClickedFoodIconElement;

            function selectFoodsByRecipe(el){
                Array.from(document.querySelectorAll("#food_buttons img")).forEach(c => this.changeIconStyle(c, false));
                let foods = el.value.split(',');
                if (foods[0] == ""){    //----„Åå„Åà„Çâ„Å∞„Çå„ÅüÊôÇ
                    this.setResultOf(document.querySelector('#food_buttons img'));
                }
                for (let i = 0; i < foods.length; i++){
                    let b = document.querySelector('#food_buttons img[name="' + foods[i] + '"]');
                    if (b != null){
                        this.selectIcon(b);
                    if (i == (foods.length - 1)) this.setResultOf(b);
                    }
                }
            }

            function selectRecipeCategory(el){
                let sb = document.getElementById("select_recipe");
                sb.innerHTML = "";
                let op = document.createElement('option');
                op.value = "";
                op.textContent = "----";
                sb.appendChild(op);

                this.recipedb.getRecipesOf(el.value).forEach(x => {
                    let op = document.createElement('option');
                    op.value = x.ingredients.map(a => a.name).join(",");
                    op.textContent = x.name;
                    sb.appendChild(op);
                })
                this.selectFoodsByRecipe(sb);
            }


            function showHideInputForm(el){
                var visible = el.getAttribute("visible") === "true";
                if (visible){
                    el.textContent = "„ÄÄË°®Á§∫‚ñº";
                    el.setAttribute("visible", "false");
                    document.getElementById("input_form").style.display = "none";
                } 
                else{
                    el.setAttribute("visible", "true");
                    el.textContent = "ÈùûË°®Á§∫‚ñ≤";
                    document.getElementById("input_form").style.display = "";                    
                }
            }


            function selectIcon(el){
                if (el.style.margin == "" || el.style.margin == "4px"){
                    el.style.margin = "0px";
                    el.style.border = "4px solid blue";
                    el.value = "ON";
                }
                else {
                    el.style.margin = "4px";
                    el.style.border = "";
                    el.value = "";
                }
            }


            function changeIconStyle(el, turnOn){
                if (turnOn){
                    el.style.margin = "0px";
                    el.style.border = "4px solid blue";
                    el.value = "ON";
                }
                else{
                    el.style.margin = "4px";
                    el.style.border = "";
                    el.value = "";
                }
            }

       

            function setInfoFromClipboard(el){
                // toggleFood(el, setIndex = -1){
                // let a = document.getElementById("input_mypoke_food_1")
                // let a = document.getElementById("input_mypoke_food_2")
                // let a = document.getElementById("input_mypoke_food_3")
                let s = el.value;

                for (let i = 0; i < el.value.length; i++){
                    switch(i){
                        case 0: this.toggleFood(document.getElementById("input_mypoke_food_1"), s[0].charCodeAt() - 65); break;
                        case 1: this.toggleFood(document.getElementById("input_mypoke_food_2"), s[1].charCodeAt() - 65); break;
                        case 2: this.toggleFood(document.getElementById("input_mypoke_food_3"), s[2].charCodeAt() - 65); break;
                        case 3: setCharacteristicFromCode(s[3]); break;
                        case 4: setSkillFromCode(s[4],  10); break;
                        case 5: setSkillFromCode(s[5],  25); break;
                        case 6: setSkillFromCode(s[6],  50); break;
                        case 7: setSkillFromCode(s[7],  75); break;
                        case 8: setSkillFromCode(s[8], 100); break;
                        default: break;
                    }
                }

                function setCharacteristicFromCode(c){
                    var list = document.getElementById("input_mypoke_char");
                    var options = Array.from(list.children);
                    var el = options.find(op => op.value == c);
                    if (el == null) return;

                    list.selectedIndex = options.indexOf(el);
                }

                function setSkillFromCode(c, skillLv){
                    var elId = "sub_skill_lv" + skillLv;
                    var list = document.getElementById(elId);
                    var options = Array.from(list.children);
                    var el = options.find(op => op.getAttribute("identifier") == c);
                    if (el == null) return;

                    list.selectedIndex = options.indexOf(el);
                }

            }


            function changeSubSkill(el){
                return;
                let boxes = Array.from(document.querySelectorAll("#sub_skill_area select"));

                let resetBoxes = (index) =>{
                    for (let i = index + 1; i < 5; i++){
                        boxes[i]
                    }

                };
                let index = area.indexOf(el);
            }





            function copyCookieValue(){
                let tb = document.getElementById("mypoke_import_cookie");
                tb.value = getCookie("rmpl");
                navigator.clipboard.writeText(tb.value);
            }

            function importCookieValue(){
                let tb = document.getElementById("mypoke_import_cookie");
                if (tb.value == ""){
                    alert("ÂÖ•Âäõ„Åó„Å¶„Åã„Çâ„ÇØ„É™„ÉÉ„ÇØ");
                    return;
                }
                document.getElementById("input_mypoke_registered").innerHTML = "";
                this.setMypokesToListFromCookie(tb.value);
            }


            function clickMyPokeVisible(el){
                let opVisible = document.getElementById("option_mypoke_visible");
                let op30 = document.getElementById("option_potential_30");
                let op50 = document.getElementById("option_potential_50");
                let op60 = document.getElementById("option_potential_60");

                if ((el == opVisible) && !opVisible.checked){
                    op30.checked = false;
                    op50.checked = false;
                    op60.checked = false                   
                }
                else if (!opVisible.checked && el.checked){
                    opVisible.checked = true;
                }
            }


            //ÂÆüÈöõ„ÅÆ„É¨„Éù„Éº„Éà„ÅØ„Åì„Åì„Åã„Çâ‰Ωú„Çâ„Çå„Çã„ÄÇÈ£üÊùê„Éú„Çø„É≥„ÅßÂÆüË°å„Åï„Çå„Çã
            function setResultOf(el = null){
                if (el == null) el = this.lastClickedFoodIconElement;
                if (el == null && this.lastClickedFoodIconElement == null) return;

                this.lastClickedFoodIconElement = el;//„Åì„Çå‰Ωï„Å´„Å§„Åã„Å£„Å¶„Çì„ÅÆÔºü

                //‰ΩúÊàê‰∏≠
                let selectedFoods = Array.from(document.getElementById('food_buttons').children).filter(el => el.value =="ON").map(el => el.name);
           
                let foods = (selectedFoods.includes(el.name)) ? [el.name] : [];
                for (let i = 0; i < selectedFoods.length; i++){
                    if (!foods.includes(selectedFoods[i])) foods.push(selectedFoods[i]);
                }

                let foodName = el.name;
                let min = document.getElementById('food_min').value;
                let onlyFullyEvolved = document.getElementById('only_fully_evolved').checked;
                let showLv30 = document.getElementById("option_poke_30").checked;
                let showLv60 = document.getElementById("option_poke_60").checked;

                let t = document.getElementById('result_table');
                t.querySelectorAll("tbody").forEach(b => b.remove());
                //t.appendChild(this.pokeReport.createReport(foodName, 500, min, onlyFullyEvolved, showLv30, showLv60)); 
                t.appendChild(this.pokeReport.createReport(foods, 50, min, onlyFullyEvolved, showLv30, showLv60));                
    
                this.insertRegisteredMyPokemons(foods, min);   
                
                let json = this.createJsonFromInputForm32(this.document.getElementById('input_mypoke_name').value);
                if (json == null) return;      

                json.backgroundColor = 7;
                this.insertMyPokemons([json], foodName, min);//ÁèæÂú®ÂÖ•Âäõ‰∏≠„ÅÆ„Ç≠„É£„É©
            }


            function showBerryPower(){
                let json = this.createJsonFromInputForm32(this.document.getElementById('input_mypoke_name').value);
                if (json == null) return;

                let res = this.createBerryPowerInfo(json);
                alert(res.mes);
            }



            function createBerryPowerInfo(json){
                berryInfoResult = {};
                let poke = pokedex.getPokemonByName(json.name);
                let oteCount = Math.round(poke.getOtetsudaiCountDay(json.lv, json.charAdjusts.speed, json.subAdjusts.speed));                
                let foodOteCount =  Math.round(oteCount * (poke.foodRate * (1 + json.charAdjusts.food + json.subAdjusts.food)));
                let berryOteCount = oteCount - foodOteCount;
                let berryPower = pokedex.getBerryPowerOf(poke.berry, json.lv);
                let berryPowerDay = Math.round(berryPower * poke.getBerryNum(json.subBerryS) * berryOteCount);
                berryInfoResult.oteCount = oteCount;
                berryInfoResult.foodOteCount = foodOteCount;
                berryInfoResult.berryOteCount = berryOteCount;
                berryInfoResult.berryPower = berryPower;
                berryInfoResult.berryPowerDay = berryPowerDay;
                berryInfoResult.mes =  poke.name + " Lv" + json.lv
                                    + "\n„Åç„ÅÆ„Åø„Åä„Å¶„Å§„Å†„ÅÑ: " + berryOteCount + "/" + oteCount
                                    + "\n„Åç„ÅÆ„Åø„Éë„ÉØ„Éº: " + berryPower
                                    + "\n1Êó•: " + berryPowerDay;
                return berryInfoResult;
            }

               
            function registerMyPoke(){
                let pokeList = this.document.getElementById('input_mypoke_name');
                let json = this.createJsonFromInputForm32(pokeList.value);
                if (json == null){
                    alert("ÁôªÈå≤ÊÉÖÂ†±„ÅåË∂≥„Çä„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ")
                    return;
                }
                let src = pokeList.getAttribute("src");
                if (src == ""){//ÈÄöÂ∏∏„ÅÆÁôªÈå≤
                    let res = window.confirm(json.name +  "\n„ÇíÁôªÈå≤„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü");
                    if (res == false) return;


                } else{//ÂÜçÁ∑®ÈõÜ
                    let res = window.confirm(json.name +  "\n„ÅÆÁ∑®ÈõÜ„ÇíÂèçÊò†„Åó„Å¶„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü");
                    if (res == false) return;
                    let op = Array.from(document.getElementById("input_mypoke_registered").children).find(op => op.value == src);
                    this.deleteMypoke(op);
                }

                this.addMyPokeToList(this.createMyPokeOption(json));
                this.listupMyPokeInfo(json);
                this.setMyPokeCookie();
                this.resetInputForm();
            }


            function deleteSelectedMyPoke(){
                let list = document.getElementById("input_mypoke_registered");
                if (list.children.length == 0) return;
                if (list.selectedOptions.length != 1){
                    alert("È†ÖÁõÆ„ÅØ‰∏Ä„Å§„Å†„Åë„Åà„Çâ„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ");
                    return;
                }

                let op = list.children[list.selectedIndex];                
                let res = window.confirm(op.textContent +  "\n„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü");
                if (res != false) this.deleteMypoke(op);

            }



            function deleteMypoke(op){
                document.getElementById("input_mypoke_registered").removeChild(op);
                this.setMyPokeCookie();
            }



            function listupMyPokeInfo(j){
                let body = document.getElementById("mypoke_quick_check").tBodies[0];
                let result = this.createBerryPowerInfo(j);

                let tr = document.createElement("tr");
                tr.style.backgroundColor = pokeReport.getColorCodeOf(j.backgroundColor);
                tr.setAttribute("value", result.berryPowerDay);
                tr.insertCell().textContent = j.name + "Lv" + j.lv + j.foodCode + " " + pokeReport.createIdentifierOf(j);
                tr.insertCell().textContent = result.berryPowerDay + "(" + result.berryOteCount + "/" + result.oteCount + ")";
                
                let rows = body.children;
                if (rows.length == 0){
                    body.appendChild(tr);
                    return;
                } else {                    
                    for (let i = 0; i < rows.length; i++){
                        let value = rows[i].getAttribute('value');
                        if (value <= result.berryPowerDay){
                            body.insertBefore(tr, rows[i]);
                            return;;                      
                        }
                    }
                    body.appendChild(tr);
                }                
            }


            function createMyPokeOption(json){
                let op = document.createElement("option");
                op.value = pokeReport.createCookieValueFromJson32(json);
                op.text = json.name + "Lv" + json.lv + json.foodCode + " " + pokeReport.createIdentifierOf(json);
                return op;
            }



            
            function addMyPokeToList(op){
                let myList = document.getElementById("input_mypoke_registered");
                if (myList.children.length >= cookie_mypoke_max){
                    alert("My„Éù„Ç±„É¢„É≥„ÅØ" + cookie_mypoke_max + "‰Ωì„Åæ„ÅßÁôªÈå≤ÂèØËÉΩ„Åß„Åô„ÄÇ");
                    return false;
                }
                myList.appendChild(op);
                return myList.children.length >= cookie_mypoke_max;
            }
            

            function createJsonFromInputForm(name){
                if (name == "") return null;       
                let j = {};
                
                j.no = pokedex.getNoByName(name);
                j.name = name;
                j.backgroundColor = Number(document.querySelector("#input_color_buttons input:checked").value);
                j.lv = Number(this.document.getElementById('input_mypoke_lv').value);
                j.foodCode = this.getMyPokeFoodCode();                
                j.char = document.getElementById("input_mypoke_char").value;
                if (j.char == "") return null;

                j.subBerryS = document.getElementById("input_mypoke_berryS").checked;
                j.subOteBonus = document.getElementById("input_mypoke_oteBonus").checked;
                j.subSpeedS = document.getElementById("input_mypoke_speedS").checked;
                j.subSpeedM = document.getElementById("input_mypoke_speedM").checked;
                j.subFoodS = document.getElementById("input_mypoke_foodS").checked;
                j.subFoodM = document.getElementById("input_mypoke_foodM").checked;
                j.subSkillS = document.getElementById("input_mypoke_skillS").checked;
                j.subSkillM = document.getElementById("input_mypoke_skillM").checked;
                j.subSkillLvUpS = document.getElementById("input_mypoke_skillLvUpS").checked;
                j.subSkillLvUpM = document.getElementById("input_mypoke_skillLvUpM").checked;
                j.subInventoryS = document.getElementById("input_mypoke_inventoryS").checked;
                j.subInventoryM = document.getElementById("input_mypoke_inventoryM").checked;
                j.subInventoryL = document.getElementById("input_mypoke_inventoryL").checked;
                j.subExpBonus = document.getElementById("input_mypoke_expBonus").checked;
                j.subGenkiBonus = document.getElementById("input_mypoke_genkiBonus").checked;
                j.subYumeBonus = document.getElementById("input_mypoke_yumeBonus").checked;
                j.researchBonus = document.getElementById("input_mypoke_researchBonus").checked;


                let charBit = this.pokeReport.getCharacteristicNumOf(j.char);
                pokeReport.setAdjustValues(j);
                return j;  
            }



            function createJsonFromInputForm32(name){
                if (name == "") return null;       
                let j = {};
                
                j.no = pokedex.getNoByName(name);
                j.name = name;
                j.lv = Number(this.document.getElementById('input_mypoke_lv').value);
                j.foodCode = this.getMyPokeFoodCode();            
                j.char = document.getElementById("input_mypoke_char").value;
                if (j.char == "") return null;

                j.ribbonEv = 0;
                j.ribbonLv = 0;
                j.backgroundColor = Number(document.querySelector("#input_color_buttons input:checked").value);

                j.subSkillList = pokeReport.getSubSkillList(
                    document.getElementById("sub_skill_lv10").value,
                    document.getElementById("sub_skill_lv25").value,
                    document.getElementById("sub_skill_lv50").value,
                    document.getElementById("sub_skill_lv75").value,
                    document.getElementById("sub_skill_lv100").value);
                
                    pokeReport.setSubSkillsEnabled(j, -1, true);//AdjustValue„ÅÆÂàùÊúüÂåñ„ÅÑ„Çâ„Å™„ÅÑ„Å™„Çâfalse
                return j;  
            }



            function getMyPokeFoodCode(){
                return document.getElementById("input_mypoke_food_1").getAttribute("code")
                     + document.getElementById("input_mypoke_food_2").getAttribute("code")
                     + document.getElementById("input_mypoke_food_3").getAttribute("code");
            }



            function insertMyPokemons(jsonList, food, min){
                pokeReport.insertMyPokeListInto(
                    document.getElementById('result_table').tBodies[0],
                    jsonList,
                    food,
                    min,
                    document.getElementById("option_potential_30").checked,
                    document.getElementById("option_potential_50").checked,
                    document.getElementById("option_potential_60").checked
                );
            }


            function insertRegisteredMyPokemons(food, min){
                if (!document.getElementById("option_mypoke_visible").checked) return;
                let list = Array.from(document.getElementById("input_mypoke_registered").children).map(op => pokeReport.createJsonFromCookieValue32(op.value));
                this.insertMyPokemons(list, food, min);
            }






            //„É≠„Éº„ÉâÊôÇ„ÄÅ„Éú„Çø„É≥„Å™„Å©„Åã„ÇâÁõ¥Êé•Âëº„Å≥Âá∫„Åï„Çå„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„ÇÇ„ÅÆ
            function setFoodImages(el, poke = null, codeFoodA = "A", codeFoodB = "A", codeFoodC = "A"){
                if (poke == null) poke = pokedex.getPokemonByName(el.value);
                if (poke == null) return;
                
                let img1 = document.getElementById('input_mypoke_food_1');
                let img2 = document.getElementById('input_mypoke_food_2');
                let img3 = document.getElementById('input_mypoke_food_3');
           
                this.setFoodImageOnImgEl(img1, poke, 1, codeFoodA);
                this.setFoodImageOnImgEl(img2, poke, 2, codeFoodB);
                this.setFoodImageOnImgEl(img3, poke, 3, codeFoodC);
            }


            function setFoodImageOnImgEl(el, poke, max, foodCode = null){
                foodCode = foodCode ?? "A";
                let codeIndex = foodCode.charCodeAt() - 65;
                let values = poke.getAllFoodNames();
                let value = values[codeIndex];

                el.setAttribute("values", values.slice(0, max).join(","));
                el.setAttribute("value", value);
                el.setAttribute("code", foodCode);
                this.toggleFood(el, codeIndex);
            }


            function toggleFood(el, setIndex = -1){
                let values = el.getAttribute("values").split(",");
                let index = values.indexOf(el.getAttribute("value"));
                let next = (setIndex != -1) ? setIndex : index + 1;
                if (next >= values.length) next = 0;
                                
                el.src = el.getAttribute("dir") + values[next] + ".png";
                el.setAttribute("value", values[next]);
                el.setAttribute("code", String.fromCharCode(65 + next));               
            }


            function resetInputForm(iName = 0, sSrc = "", edidMode = false, nLv = 30, iChar = 0, ilv10skill = 0, ilv25skill = 0, ilv50skill = 0, ilv75skill = 0, ilv100skill = 0, bgIndex = 0){
                let res = window.confirm("ÂÖ•ÂäõÊÉÖÂ†±„Çí„É™„Çª„ÉÉ„Éà„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü");
                if (res == false) return;

                let pokeList = document.getElementById('input_mypoke_name');
                pokeList.selectedIndex = iName;
                pokeList.setAttribute("src", sSrc);
                pokeList.style.backgroundColor = (edidMode) ? "#FF8899" : "";
                
                document.getElementById('input_mypoke_lv').selectedIndex = nLv - 1;
                document.getElementById("input_mypoke_char").selectedIndex = iChar;     
                document.getElementById("sub_skill_lv10").selectedIndex  = ilv10skill;
                document.getElementById("sub_skill_lv25").selectedIndex  = ilv25skill;
                document.getElementById("sub_skill_lv50").selectedIndex  = ilv50skill;
                document.getElementById("sub_skill_lv75").selectedIndex  = ilv75skill;
                document.getElementById("sub_skill_lv100").selectedIndex = ilv100skill;
                document.getElementById("sub_skill_import").value = "";
                document.getElementById("input_color_buttons").querySelectorAll("input")[bgIndex].checked = true;
            }




            function reeditMypoke(){
                let list = document.getElementById("input_mypoke_registered");
                if (list.children.length == 0) return;

                let j = pokeReport.createJsonFromCookieValue32(list.value);
                this.setJsonToInputFormForReEdit(j);
                document.getElementById('input_mypoke_name').focus();
            }


            function setJsonToInputFormForReEdit(j){
                let poke = pokedex.getPokemonByName(j.name);
                let pokeList = document.getElementById("input_mypoke_name");
                if (pokeList.children.length == 0) this.initializePokeList(); //Âàù„ÇÅ„Å¶„É™„Çπ„Éà„Å´Ëß¶„Å£„ÅüÊôÇ„Å´ÂÆüË°å„Åï„Çå„Çã„Åì„Å®„Å´„Å™„Å£„Å¶„ÅÑ„Çã

                //„Éù„Ç±„É¢„É≥Âêç„ÄÅ„Åõ„ÅÑ„Åã„Åè„ÅØ„É™„Çπ„Éà„ÅÆIndex„ÇíÊé¢„ÅôÂøÖË¶Å„Åå„ÅÇ„Çã„Åü„ÇÅ„ÄÅÂæå„ÅßÁõ¥Êé•ÂÖ•Âäõ„ÄÇ
                this.resetInputForm(0, j.src, true, j.lv, 0, j.subSkillList.lv10.value, j.subSkillList.lv25.value, j.subSkillList.lv50.value, j.subSkillList.lv75.value, j.subSkillList.lv100.value, j.backgroundColor);                
                document.getElementById("input_mypoke_name").value = j.name;
                Array.from(document.getElementById("input_mypoke_char").children).find(o => o.value == j.char).selected = true;
                this.setFoodImages(null, poke, j.foodCode[0], j.foodCode[1], j.foodCode[2]);
            }

       

            function initializePokeList(){
                if (this.selectBoxInitialized) return;

                let list = document.getElementById('input_mypoke_name');
                let blankOp = document.createElement('option');
                blankOp.text = "";
                blankOp.value = "";
                list.appendChild(blankOp);

                let names = pokemons.map(p => p.name).sort();
                for (let i = 0; i < names.length; i++){
                    let op = document.createElement('option');                    
                    op.text = names[i];
                    op.value = names[i];   
                    list.appendChild(op);                 
                }

                list = document.getElementById('input_mypoke_lv');
                blankOp = document.createElement('option');


                for (let i = 1; i <= 60; i++){
                    let op = document.createElement('option');                    
                    op.text = i;
                    op.value = i;   
                    list.appendChild(op);                 
                }
                list.selectedIndex = 29;

                this.selectBoxInitialized = true;
            }



            //ÂàùÊúüÂåñÈñ¢ÈÄ£
            function setSubSkillSelectBoxes(){
                let addOp = (listId, skillValue, skillText, idChar) => {
                    let list = document.getElementById(listId);
                    let op = document.createElement("option");
                    op.value = skillValue;
                    op.textContent = skillText;
                    op.setAttribute("identifier", idChar);
                    list.appendChild(op);
                };

                let subSkillList = [
                    ["","",""],["oteBonus", "„Åä„Å¶„Éú","o"],["speedS", "„Åä„Å¶„Çπ„ÉîS","."],["speedM", "„Åä„Å¶„Çπ„ÉîM",":"],["foodS", "È£üÊùêÁ¢∫ÁéáS","f"],["foodM", "È£üÊùêÁ¢∫ÁéáM","F"],["skillS", "„Çπ„Ç≠„É´Á¢∫ÁéáS","-"],["skillM", "„Çπ„Ç≠„É´Á¢∫ÁéáM","+"],
                    ["skillLvUpS", "„Çπ„Ç≠„É´LvS","u"],["skillLvUpM", "„Çπ„Ç≠„É´LvM","U"],["berryS", "„Åç„ÅÆ„ÅøS","s"],["inventoryS", "ÊâÄÊåÅS","'"],["inventoryM", "ÊâÄÊåÅM", '"'],["inventoryL", "ÊâÄÊåÅL","*"],
                    ["expBonus", "EXP„Éú","e"],["genkiBonus", "„Åí„Çì„Åç„Éú","g"],["yumeBonus", "„ÇÜ„ÇÅ„Éú","y"],["researchBonus", "„É™„Çµ„Éº„ÉÅ„Éú","r"]
                ];

                subSkillList.forEach(s => addOp("sub_skill_lv10", s[0], s[1], s[2]));
                subSkillList.forEach(s => addOp("sub_skill_lv25", s[0], s[1], s[2]));
                subSkillList.forEach(s => addOp("sub_skill_lv50", s[0], s[1], s[2]));
                subSkillList.forEach(s => addOp("sub_skill_lv75", s[0], s[1], s[2]));
                subSkillList.forEach(s => addOp("sub_skill_lv100", s[0], s[1], s[2]));
            }

            //„ÇØ„ÉÉ„Ç≠„ÉºÈñ¢ÈÄ£(ÁôªÈå≤)
            function setMyPokeCookie(){
                let options = document.getElementById("input_mypoke_registered").children;
                let sorted = Array.from(options).sort((a, b) => a.textContent > b.textContent ? 1 : -1);
                let values = [];
                for (let i = 0; i < sorted.length; i++){
                    values.push(sorted[i].value);
                }

                setCookie("rmpl", values.join("/"), 365);
            }     

            //„ÇØ„ÉÉ„Ç≠„ÉºÈñ¢ÈÄ£(Âëº„Å≥Âá∫„Åó)
            function setMypokesToListFromCookie(c = null){
                c = c ?? getCookie("rmpl");
                //‚Üì„ÉÜ„Çπ„ÉàÁî®
                //c = "5o3or-505-0/2ppsn-cg0-9aed3/74gqq-a01-965f7/74h8l-eg1-173d8/74hsl-1-c85d3/6j9sp-lg1-3d547/hoqn-d02-14fgb/hrop-500-dc592/1t28q-ag0-13b64/183oq-600-a3be6/15b4l-a00-g5726/vpsl-l00-db000/vpsp-500-dg000/29sq-1-8426b/2a2p-0-28400/2bop-6g0-af519/spir-1-2d1cb/5u16r-e00-354b6/5u20q-e00-c2d48/5u3ol-m00-1d578/9jal-5g0-af4b2/5v1sp-m00-2c000/5v1sq-ag1-86000/5v1sr-d00-46000/5ohsl-600-3286g/nhul-e00-b6000/niqq-m00-a54bc/nj8q-600-376hb/j0ql-e01-7b000/j1sn-d00-34000/j1sr-m00-32000/26jmq-6g0-1d745/3jj2l-5g0-a9h16/cp6m-e00-5d400/cq6q-e00-526b3/1o9sm-gg1-42b6g/1oa2q-0-9248c/2rbem-e00-hab72/2rbol-a02-a3600/2rbol-lg2-fa600/3hhul-m00-cae00/3hi8l-0-25bch/1gpsm-eg1-14ab6/17bop-ig0-23a68/1u1sp-2-15a82/puq-h00-d3500/r4l-ag0-ae5g2/a3eq-0-ab71e/2cgum-ig1-b1346/2cguq-a01-49136/731sl-e00-97d3b/16joq-9g0-a7623/3j1sp-1-31d00/3j1sr-eg1-b4900/1sq4l-0-da423/6iqr-1-1acf4/6jaq-gg0-9a45b/6jon-600-1a7f2/73r4l-l00-b74c2/1gql-501-ead78/1gqn-1-f243b/1i6q-ig0-168h4";
                if (c == null) return; 

                let jss = c.split("/").map(x => pokeReport.createJsonFromCookieValue32(x));
                pokeReport.setMyPokeFoodListInfo(document.getElementById("mypoke_quick_check_food").tBodies[0], jss);
                
                for (let i = 0; i < jss.length; i++){
                    this.listupMyPokeInfo(jss[i]);
                    let maxFlag = this.addMyPokeToList(this.createMyPokeOption(jss[i]));
                    if (maxFlag){
                        alert("ÈôêÁïå");
                        return;
                    }            
                }
            }   

            

            //„É≠„Éº„ÉâÊôÇ„ÅÆ„Ç§„Éô„É≥„Éà
            window.onload = ()=>{
                this.pokedex = new Pokedex();
                this.pokemons = pokedex.pokemons;
                this.recipedb = new RecipeDB();
                this.pokeReport = new PokeReport(this.pokedex, this.recipedb);
                this.pokeReport.initialize();
                this.selectBoxInitialized = false;

                this.setSubSkillSelectBoxes();
                this.setMypokesToListFromCookie();  
                this.selectRecipeCategory(document.getElementById("select_recipe_category"));

                let c = getCookie("ropt");   
                if (c != null){
                    this.pokeReport.setOptionsFromCookie(c);
                }
                
            }

            
     



        </script>
    </body>

</html>
