<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="style.css" rel="stylesheet"/>
        <script src="js/main.js"></script>
        <script src="js/pokedex.js"></script>  
        <script src="js/recipedb.js"></script>  
        
        <title>各種計算</title>
        
        <style>
            #member_table{
                background-color: lightcyan;

            }

            #member_table tr{
                display: table;;
            }

            .calc_input_order{
                width:2em;

            }
            .calc_input_name{
                width:8em;
            }

            .calc_input_food_num{
                width:2em;
            }
            .calc_list_food{
                font-size:1em;
            }
        </style>
    </head>


    <body>
        <p>
            <a href = "./index.html">ポケモン</a>
            <a href = "./sleep.html">睡眠計算</a>
            <a href = "./cook.html">料理</a>
            <a href = "./calc.html" class="current">各種計算</a>
        </p>

        <p>

            <table id="member_table">
                <tbody id="member_1">
                    <tr>
                        <td>番号: <input type="text" class="calc_input_order"></td>
                        <td>名前: <input type="text" class="calc_input_name"></td>
                        <td>ポケモン: <select class="pokedex_list" onchange="setPokeInfo(this)"></select> <span>～の実</span></td>
                        <td><button class="smaller">▼</button></td>
                    </tr>
                    <tr>
                        <td><input type="text" class="calc_input_order">分 <input type="text" class="calc_input_order">秒</td>
                        <td><input type="checkbox">きのみS</td>
                        <td><input type="checkbox">食S</td>
                        <td><input type="checkbox">食M</td>
                        <td><input type="checkbox">食↑</td>
                        <td><input type="checkbox">食↓</td>
                        <td><button class="smaller">エクスポート</button></td>
                    </tr>

                    <tr>
                        <td>食材1:
                            <select class="calc_list_food food1">
                                <option value = "----">----</option>
                                <option value="あじわいキノコ">あじわいキノコ</option>
                                <option value="あったかジンジャー">あったかジンジャー</option>
                                <option value="あまいミツ">あまいミツ</option>
                                <option value="あんみんトマト">あんみんトマト</option>
                                <option value="おいしいシッポ">おいしいシッポ</option>
                                <option value="げきからハーブ">げきからハーブ</option>
                                <option value="とくせんエッグ">とくせんエッグ</option>
                                <option value="とくせんリンゴ">とくせんリンゴ</option>
                                <option value="ふといながねぎ">ふといながねぎ</option>
                                <option value="ほっこりポテト">ほっこりポテト</option>
                                <option value="ピュアなオイル">ピュアなオイル</option>
                                <option value="マメミート">マメミート</option>
                                <option value="モーモーミルク">モーモーミルク</option>
                                <option value="リラックスカカオ">リラックスカカオ</option>                
                                <option value="ワカクサコーン">ワカクサコーン</option>
                                <option value="ワカクサ大豆">ワカクサ大豆</option>
                            </select>
                            <input type="text" class="calc_input_food_num">個
                        </td>
                    </tr>

                    <tr>
                        <td>食材2:
                            <select class="calc_list_food food2">
                                <option value = "----">----</option>
                                <option value="あじわいキノコ">あじわいキノコ</option>
                                <option value="あったかジンジャー">あったかジンジャー</option>
                                <option value="あまいミツ">あまいミツ</option>
                                <option value="あんみんトマト">あんみんトマト</option>
                                <option value="おいしいシッポ">おいしいシッポ</option>
                                <option value="げきからハーブ">げきからハーブ</option>
                                <option value="とくせんエッグ">とくせんエッグ</option>
                                <option value="とくせんリンゴ">とくせんリンゴ</option>
                                <option value="ふといながねぎ">ふといながねぎ</option>
                                <option value="ほっこりポテト">ほっこりポテト</option>
                                <option value="ピュアなオイル">ピュアなオイル</option>
                                <option value="マメミート">マメミート</option>
                                <option value="モーモーミルク">モーモーミルク</option>
                                <option value="リラックスカカオ">リラックスカカオ</option>                
                                <option value="ワカクサコーン">ワカクサコーン</option>
                                <option value="ワカクサ大豆">ワカクサ大豆</option>
                            </select>
                            <input type="text" class="calc_input_food_num">個
                        </td>             
                        <td style="display: none;">
                            <button class="smaller">aaa</button>
                        </td>       
                    </tr>

                    <tr>
                        <td>食材3:
                            <select class="calc_list_food food3">
                                <option value = "----">----</option>
                                <option value="あじわいキノコ">あじわいキノコ</option>
                                <option value="あったかジンジャー">あったかジンジャー</option>
                                <option value="あまいミツ">あまいミツ</option>
                                <option value="あんみんトマト">あんみんトマト</option>
                                <option value="おいしいシッポ">おいしいシッポ</option>
                                <option value="げきからハーブ">げきからハーブ</option>
                                <option value="とくせんエッグ">とくせんエッグ</option>
                                <option value="とくせんリンゴ">とくせんリンゴ</option>
                                <option value="ふといながねぎ">ふといながねぎ</option>
                                <option value="ほっこりポテト">ほっこりポテト</option>
                                <option value="ピュアなオイル">ピュアなオイル</option>
                                <option value="マメミート">マメミート</option>
                                <option value="モーモーミルク">モーモーミルク</option>
                                <option value="リラックスカカオ">リラックスカカオ</option>                
                                <option value="ワカクサコーン">ワカクサコーン</option>
                                <option value="ワカクサ大豆">ワカクサ大豆</option>
                            </select>
                            <input type="text" class="calc_input_food_num">個
                        </td>      
                        <td>
                            <select class="calc_list_food">
                                <option value = "----">----</option>
                                <option value="あじわいキノコ">あじわいキノコ</option>
                                <option value="あったかジンジャー">あったかジンジャー</option>
                                <option value="あまいミツ">あまいミツ</option>
                                <option value="あんみんトマト">あんみんトマト</option>
                                <option value="おいしいシッポ">おいしいシッポ</option>
                                <option value="げきからハーブ">げきからハーブ</option>
                                <option value="とくせんエッグ">とくせんエッグ</option>
                                <option value="とくせんリンゴ">とくせんリンゴ</option>
                                <option value="ふといながねぎ">ふといながねぎ</option>
                                <option value="ほっこりポテト">ほっこりポテト</option>
                                <option value="ピュアなオイル">ピュアなオイル</option>
                                <option value="マメミート">マメミート</option>
                                <option value="モーモーミルク">モーモーミルク</option>
                                <option value="リラックスカカオ">リラックスカカオ</option>                
                                <option value="ワカクサコーン">ワカクサコーン</option>
                                <option value="ワカクサ大豆">ワカクサ大豆</option>
                            </select>
                            <button class="smaller">メンバーに加える</button>
                            <button value="1" class="smaller" onclick="createJson(this);">json</button>
                        </td>             
                    </tr>
                </tbody>
            </table>
        </p>

        <p>
            <div style="width:80%; margin: auto;">
                <canvas id="myChart"></canvas>
            </div>
        </p>





        <!--以下、スクリプト-->
        <script>
            this.pokedex = new Pokedex();
            function createJson(el){
                let t = el.closest('table');
                let json = {};
                this.addJsonOfRow1(t.tBodies[0], json);
                this.addJsonOfRow2(t.tBodies[0], json);
                console.log(json);

                return json;
            }

            function setPokeInfo(pokeSelectBox){
                //テスト後、以下の処理は削除すること━━━━━ 
                //━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                let table = pokeSelectBox.closest('table');

                let poke = this.pokedex.getPokemonByName(pokeSelectBox.value);
                if (poke == null){
                    pokeSelectBox.parentElement.children[1].textContent = "～の実";
                    return;
                }
                pokeSelectBox.parentElement.children[1].textContent = poke.berry + "/" + this.pokedex.getBerryPowerBaseOf(poke.berry);
                console.log(table.getElementsByClassName('food1')[0]);
                this.setFoodsOnListBox(table.getElementsByClassName('food1')[0], poke);
                this.setFoodsOnListBox(table.getElementsByClassName('food2')[0], poke);
                this.setFoodsOnListBox(table.getElementsByClassName('food3')[0], poke);
            }

            function setFoodsOnListBox(listBox, poke){
                listBox.innerHTML = "";
                
                let opFirst = document.createElement('option');
                opFirst.value  = "-----";
                opFirst.textContent = "-----";
                listBox.appendChild(opFirst);

                let foods = [poke.food1, poke.food2, poke.food3];
                for (let i = 0; i < foods.length; i++){
                    let op = document.createElement('option');
                    op.value = foods[i];
                    op.textContent = foods[i];
                    listBox.appendChild(op);
                }
            }


            function addPokedexToListbox(el){
                let pokeNames = this.pokedex.pokemons.map(p => p.name);
                pokeNames.sort();
                let opFirst = document.createElement('option');
                opFirst.value  = "-----";
                opFirst.textContent = "-----";
                el.appendChild(opFirst);
                for (let i = 0; i < pokeNames.length; i++){
                    let op = document.createElement('option');
                    op.value = pokeNames[i];
                    op.textContent = pokeNames[i];
                    el.appendChild(op);
                }
            }

            function addJsonOfRow1(tbody, json){
                let r = tbody.children[0];
                json.order = r.children[0].getElementsByTagName('input')[0].value;
                json.name = r.children[1].getElementsByTagName('input')[0].value;
                json.pokemonName = r.children[2].getElementsByTagName('select')[0].value;
            }

            function addJsonOfRow2(tbody, json){
                let r = tbody.children[1];
                json.oteMinutes = r.children[0].getElementsByTagName('input')[0].value;
                json.oteSecs =    r.children[0].getElementsByTagName('input')[1].value;
                json.berryDropS =   r.children[1].getElementsByTagName('input')[0].checked;
                json.foodDropS =    r.children[2].getElementsByTagName('input')[0].checked;
                json.foodDropM =    r.children[3].getElementsByTagName('input')[0].checked;
                json.foodDropUp =   r.children[4].getElementsByTagName('input')[0].checked;
                json.foodDropDown = r.children[5].getElementsByTagName('input')[0].checked;
            }


            

            window.onload = ()=>{
                addPokedexToListbox(document.getElementsByClassName('pokedex_list')[0]);
            }
        </script>
    </body>

</html>
